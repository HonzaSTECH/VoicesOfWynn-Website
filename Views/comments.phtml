<script>
    var npcId = <?= ${basename(__FILE__, '.phtml').'_recording'}->npcId ?>;
    var voiceActorId = <?= ${basename(__FILE__, '.phtml').'_voice_actor_id'} ?>;
    var userId = "<?= @${basename(__FILE__, '.phtml').'_user_id'} ?>";
    var userName = "<?= @${basename(__FILE__, '.phtml').'_user_name'} ?>";
    var userAvatar = "<?= @${basename(__FILE__, '.phtml').'_user_avatar'} ?>";
</script>

<h1>Comment Section</h1>
<h3 style="text-align: center;"><?= ${basename(__FILE__, '.phtml').'_recording_title'} ?></h3>
<p style="text-align: center;"><audio controls>
    <source src="dynamic/recordings/<?= ${basename(__FILE__, '.phtml').'_recording'}->file ?>" type="audio/ogg">
    Oops! Your browser doesnt support the OGG format :(
</audio></p>
<br>
<p style="text-align: center;"><button id="new-comment-button">Post new Comment</button></p>
<hr>
<p style="text-align: center;"><button id="hide-form-button">Hide the form</button></p>
<form method="post" data-recording-id="<?= ${basename(__FILE__, '.phtml').'_recording'}->id ?>">
<fieldset style="border-radius: 5px;" class="comment-writing-form">
<?php if (${basename(__FILE__, '.phtml').'_logged_in'}) : ?>
<div>
<div id="contributor-option" class="comment-tab selected as-contributor">Post as a contributor</div>
<div id="guest-option" class="comment-tab as-guest">Post as a guest</div>
</div>
<div id="contributor-form" class="comment-form-wrapper">
    <fieldset style="border-radius: 5px; background: whitesmoke; border: none; border-top: 3px solid #bdbdbd; border-top-left-radius: 0px; border-top-right-radius: 0px;">
        <label for="content-contributor">Comment: </label><br>
        <textarea id="content-contributor" placeholder="You can praise the voice actor, suggest what could be improved or just say how much you like this quest. Just please, keep bad words out of that ðŸ˜‰"></textarea>
    </fieldset>
    <input type="submit" value="Send" />
    <small class="comment-disclaimer">
        Name and contents of the comment will be publicly visible.<br>
        The comment will be linked to your account and you'll be able to delete it anytime.
    </small>
</div>
<?php endif ?>
<div id="guest-form" <?php if (${basename(__FILE__, '.phtml').'_logged_in'}) : ?>style="display:none;"<?php endif ?>>
	<?php if (!${basename(__FILE__, '.phtml').'_logged_in'}) : ?>
        <span class="comment-disclaimer">Are you a contributor? You can post a verified comment after <a href="login">logging in</a>.</span>
	<?php endif ?>
    <fieldset style="border-radius: 5px; background: whitesmoke; border: none; border-top: 3px solid #bdbdbd; border-top-left-radius: 0px; border-top-right-radius: 0px;">
        <label for="name">Name: </label><input id="name" type="text" placeholder="Anonymous" /><br>
        <label for="email">E-mail: </label><input id="email" type="text" placeholder="Used to get Gravatar; not required" /><br>
        <label for="content-guest">Comment: </label><br>
        <textarea id="content-guest" placeholder="You can praise the voice actor, suggest what could be improved or just say how much you like this quest. Just please, keep bad words out of that ðŸ˜‰"></textarea>
    </fieldset>
    <label for="antispam">Not a robot? Then you can select some shade of <strong style="color:<?= ${basename(__FILE__, '.phtml').'_antispam_color_code'} ?>;"><?= ${basename(__FILE__, '.phtml').'_antispam_color'} ?></strong>, right?</label><br>
    <input id="antispam" type="color" required />
    <input type="submit" value="Send" onClick="window.location.reload();"/>
    <small class="comment-disclaimer">
        Name and contents of the comment will be publicly visible.<br>
        You will be able to delete this comment only from this IP.<br>
        Your IP and e-mail addresses and will be stored, but will never be publicly visible.
    </small>
</div>
</fieldset>
</form>

<div id="comments" style="margin: auto;">
<?php foreach (${basename(__FILE__, '.phtml').'_comments'} as $comment) : ?>
<div class="comment" style="margin: auto;">
    <table style="margin-top: -45px;">
        <tr>
            <td rowspan="2"><img src="<?= $comment->getAvatar() ?>" alt="Avatar" class="comment-avatar"/></td>
            <td class="comment-main-column">
                <strong>
                    <?php if ($comment->verified) : ?>
                        <a href="cast/<?= $comment->userId ?>"><?= $comment->getName() ?></a>
                    <?php else : ?>
                        <p style="padding-top: 8px;"><?= $comment->getName() ?></p>
                    <?php endif ?>
                    </strong>
                <?php if ($comment->verified) : ?>
	                <?php if ($comment->userId === ${basename(__FILE__, '.phtml').'_voice_actor_id'}) : ?>
                        <div class="author-badge" title="This user is the author of this recording.">Author</div>
	                <?php endif ?>
                    <div class="contributor-badge" title="This user contributed to this project.">Contributor</div>
                <?php endif ?>
            </td>
            <td>
            <?php if (${basename(__FILE__, '.phtml').'_admin'} || in_array($comment->id, ${basename(__FILE__, '.phtml').'_owned_comments'})) : ?>
                <button data-comment-id="<?= $comment->id ?>" class="delete-comment-button">Ã—</button>
	        <?php endif ?>
            </td>
        </tr>
        <tr></tr>
        <tr class="comment-container"><p style="width: 100% "><hr style="width: 95%;bottom: -97px;position: relative;"></p><td class="comment-main-column"><div class="comment-content"><p style="min-width: 110%;margin-top: -25px;margin-bottom: -30px;"><?= $comment->content ?></p></div></td></tr>
    </table>
</div><br>
<?php endforeach ?>
</div>

<br>
<button class="backbtn" onclick="history.go(-1)">< Go Back</button>