<script>var npcId = <?= ${basename(__FILE__, '.phtml').'_npc'}->getId() ?>;</script>

<h1><?= ${basename(__FILE__, '.phtml').'_npc'}->getName() ?></h1>
<img src="dynamic/npcs/<?= ${basename(__FILE__, '.phtml').'_npc'}->getName() ?>.png" alt="NPC picture" />
<p>
    <strong>Voice actor: </strong>
    <?php if (${basename(__FILE__, '.phtml').'_voice_actor'} === null) : ?>
        <img id="voice-actor-avatar" class="avatar" src="dynamic/avatars/defaultAvatar.png" alt="Profile picture" />
        <span id="voice-actor-name"><i>Nobody</i></span>
    <?php else : ?>
        <img id="voice-actor-avatar" class="avatar" src="dynamic/avatars/<?= ${basename(__FILE__, '.phtml').'_voice_actor'}->getAvatarLink() ?>" alt="Profile picture" />
        <span id="voice-actor-name"><?= ${basename(__FILE__, '.phtml').'_voice_actor'}->getName() ?></span>
    <?php endif ?>
    <button id="change-actor-btn">Change</button>
    <form id="voice-actor-form">
        <select name="actor">
	        <?php if (${basename(__FILE__, '.phtml').'_voice_actor'} === null) : ?>
                <option selected disabled hidden></option>
	        <?php endif ?>
            <?php foreach (${basename(__FILE__, '.phtml').'_voice_actors'} as $vactor) : ?>
	            <?php if (!${basename(__FILE__, '.phtml').'_voice_actor'} === null && ${basename(__FILE__, '.phtml').'_voice_actor'}->getId() === $vactor->getId) : ?>
                <option checked value="<?= $vactor->getId() ?>" data-avatar-link="<?= $vactor->getAvatarLink() ?>"><?= $vactor->getName() ?></option>
                <?php else : ?>
                <option value="<?= $vactor->getId() ?>" data-avatar-link="<?= $vactor->getAvatarLink() ?>"><?= $vactor->getName() ?></option>
                <?php endif ?>
            <?php endforeach ?>
        </select>
        <input type="submit" value="Confirm" />
    </form>
</p>

<h3>Recordings</h3>
<?php foreach (${basename(__FILE__, '.phtml').'_quest_recordings'} as $quest) : ?>
<section>
    <table>
        <tr><th colspan="5"><?= $quest->getName() ?></th></tr>
	    <?php $recordings = $quest->getNpcs()[0]->getRecordings(); ?>
        <?php foreach ($recordings as $recording) : ?>
        <tr>
            <td># <?= $recording->line ?></td>
            <td>
                <audio controls>
                    <source src="dynamic/recordings/<?= $recording->file ?>" type="audio/ogg">
                    Your browser does not support the OGG audio format.
                </audio>
            <td style="color: green; font-weight: bolder;"><?= $recording->upvotes ?></td>
            <td style="color: red; font-weight: bolder;"><?= $recording->downvotes ?></td>
            <td><button class="delete-recording-btn" data-recording-id="<?= $recording->id ?>">Ã—</button></td>
        </tr>
        <?php endforeach ?>
    </table>
    <form method="post" enctype="multipart/form-data" class="new-recording-form">
        <h4>Add new recording</h4>
        <input name="questId" type="hidden" value="<?= $quest->getId() ?>" />
        <table>
            <tr><th>File</th><th>Line #</th></tr>
            <tbody class="new-recording-items-container">
                <tr class="new-recording-item">
                    <td>
                        <input name="recording1" type="file" accept="audio/ogg" class="recording-input" required/>
                    </td>
                    <td>
                        <input name="line1" type="number" min="1" max="32767" value="<?= $recordings[count($recordings) -1]->line+1 ?>" class="line-input" required/>
                    </td>
                </tr>
            </tbody>
        </table>
        <button class="add-more-recordings-button">Add more</button>
        <input type="submit" value="Upload"/>
    </form>
    <?php if (isset(${basename(__FILE__, '.phtml').'_uploadErrors'}[$quest->getId()])) : ?>
        <?= ${basename(__FILE__, '.phtml').'_uploadErrors'}[$quest->getId()] ?>
    <?php endif ?>
</section>
<?php endforeach ?>

